# inferencepool_no_matching_pods_route_status.yaml

# This manifest defines an InferencePool with a selector that is NOT expected
# to match any running pods. It also defines an HTTPRoute that uses this
# InferencePool as a backend.

# --- InferencePool Definition ---
apiVersion: inference.networking.x-k8s.io/v1alpha2
kind: InferencePool
metadata:
  # This name must match the 'poolName' variable defined in the
  # conformance/tests/basic/inferencepool_no_matching_pods_route_status.go test file.
  name: pool-no-pods
  namespace: gateway-conformance-app-backend
spec:
  # --- Selector (Required) ---
  # Selector is intentionally designed to not match any pods.
  selector:
    app: "non-existent-app"
  targetPortNumber: 8080
  extensionRef:
    name: pool-no-pods-epp
    failureMode: FailClose

---
# --- HTTPRoute Definition ---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: httproute-for-pool-no-pods
  namespace: gateway-conformance-app-backend
spec:
  parentRefs:
  - group: gateway.networking.k8s.io
    kind: Gateway
    name: conformance-gateway # Name of the shared Gateway from base manifests
    namespace: gateway-conformance-infra  # Namespace of the shared Gateway
    sectionName: http
  - backendRefs:
    - group: inference.networking.x-k8s.io
      kind: InferencePool
      name: pool-no-pods
      port: 8080
    matches:
    - path:
        type: PathPrefix
        value: /no-pods-pool-test
